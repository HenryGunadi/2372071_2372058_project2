<!DOCTYPE html>
<html lang="id">
<head>
  <meta charset="UTF-8">
  <title>Detail Event</title>
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">

  <!-- Favicons -->
  <link href="assets/img/favicon.png" rel="icon">
  <link href="assets/img/apple-touch-icon.png" rel="apple-touch-icon">

  <!-- Fonts -->
  <link href="https://fonts.googleapis.com" rel="preconnect">
  <link href="https://fonts.gstatic.com" rel="preconnect" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Roboto:wght@300;400;700&family=Raleway:wght@300;400;700&display=swap" rel="stylesheet">

  <!-- Vendor CSS Files -->
  <link href="assets/vendor/bootstrap/css/bootstrap.min.css" rel="stylesheet">
  <link href="assets/vendor/bootstrap-icons/bootstrap-icons.css" rel="stylesheet">
  <link href="assets/vendor/aos/aos.css" rel="stylesheet">
  <link href="assets/vendor/glightbox/css/glightbox.min.css" rel="stylesheet">
  <link href="assets/vendor/swiper/swiper-bundle.min.css" rel="stylesheet">

  <!-- Main CSS File -->
  <link href="assets/css/main.css" rel="stylesheet">
</head>

<style>
  header.header {
    background-color: #2c2f4b;
  }
  .navmenu a, .navmenu a:visited {
    color: #A9A9A9 !important;
  }
  .navmenu a:hover {
    color: #f82249 !important;
  }
</style>

<body>
  <header id="header" class="header d-flex align-items-center fixed-top">
    <div class="container-fluid container-xl position-relative d-flex align-items-center">
      <a href="index.html" class="logo d-flex align-items-center me-auto">
        <img src="assets/img/logo.png" alt="">
      </a>
      <nav id="navmenu" class="navmenu">
        <ul>
          <li><a href="#hero" class="active">Home</a></li>
          <li><a href="#speakers">Speakers</a></li>
          <li><a href="#schedule">Schedule</a></li>
          <li><a href="#venue">Venue</a></li>
          <li><a href="#hotels">Hotels</a></li>
          <li><a href="#gallery">Gallery</a></li>
          <li class="dropdown"><a href="#"><span>Dropdown</span> <i class="bi bi-chevron-down toggle-dropdown"></i></a>
            <ul>
              <li><a href="#">Dropdown 1</a></li>
              <li class="dropdown"><a href="#"><span>Deep Dropdown</span> <i class="bi bi-chevron-down toggle-dropdown"></i></a>
                <ul>
                  <li><a href="#">Deep Dropdown 1</a></li>
                  <li><a href="#">Deep Dropdown 2</a></li>
                  <li><a href="#">Deep Dropdown 3</a></li>
                </ul>
              </li>
              <li><a href="#">Dropdown 2</a></li>
            </ul>
          </li>
          <li><a href="#contact">Contact</a></li>
        </ul>
        <i class="mobile-nav-toggle d-xl-none bi bi-list"></i>
      </nav>
      <a class="cta-btn d-none d-sm-block" id="auth-button" href="/login.html">Get Started</a>
    </div>
  </header>

  <section class="event-detail section py-5" style="margin-top: 100px;">
    <div class="container">
      <div class="row align-items-start" id="event-detail">
        <!-- Konten detail event akan dimuat via JS -->
      </div>
    </div>
  </section>

  <!-- MODAL PENDAFTARAN -->
  <div class="modal fade" id="daftarModal" tabindex="-1" aria-labelledby="daftarModalLabel" aria-hidden="true">
    <div class="modal-dialog">
      <div class="modal-content">
        <form id="daftarForm">
          <div class="modal-header">
            <h5 class="modal-title" id="daftarModalLabel">Formulir Pendaftaran</h5>
            <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Tutup"></button>
          </div>
          <div class="modal-body">
            <div class="mb-3">
              <label for="nama" class="form-label">Nama Lengkap</label>
              <input type="text" class="form-control" id="nama" required>
            </div>
            <div class="mb-3">
              <label for="email" class="form-label">Email</label>
              <input type="email" class="form-control" id="email" required>
            </div>
            <div class="mb-3">
              <label for="bukti" class="form-label">Upload Bukti Pembayaran</label>
              <input type="file" class="form-control" id="bukti" accept="image/*,application/pdf" required>
            </div>
            <div class="form-check mb-3">
              <input type="checkbox" class="form-check-input" id="konfirmasiCheckbox" required>
              <label class="form-check-label" for="konfirmasiCheckbox">
                Saya yakin ingin mendaftar dan melakukan pembayaran
              </label>
            </div>
          </div>
          <div class="modal-footer">
            <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Batal</button>
            <button type="submit" class="btn btn-primary">Daftar</button>
          </div>
        </form>
      </div>
    </div>
  </div>

  <!-- Bootstrap JS -->
  <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>

  <script>
    document.addEventListener("DOMContentLoaded", async () => {
      // Ambil user dari localStorage
      const user = JSON.parse(localStorage.getItem("user"));

      if (user) {
        document.getElementById("nama").value = user.name;
        document.getElementById("email").value = user.email;
        document.getElementById("nama").readOnly = true;
        document.getElementById("email").readOnly = true;
      } else {
        alert("Harap login terlebih dahulu.");
        return;
      }

      // Ambil ID event dari URL
      const urlParams = new URLSearchParams(window.location.search);
      const eventId = urlParams.get("id");

      if (!eventId) {
        document.getElementById("event-detail").innerHTML = "<p>Event tidak ditemukan.</p>";
        return;
      }

      try {
        const response = await fetch(`/api/event/${eventId}`);
        const { data: event } = await response.json();

        const eventDaysStr = event.event_days.map((day) => {
          const date = new Date(day.date).toLocaleDateString('id-ID', {
            weekday: 'long', year: 'numeric', month: 'long', day: 'numeric'
          });
          const start = new Date(day.start_time).toLocaleTimeString('id-ID', {
            hour: '2-digit', minute: '2-digit'
          });
          const end = new Date(day.end_time).toLocaleTimeString('id-ID', {
            hour: '2-digit', minute: '2-digit'
          });
          return `<li>${date} (${start} - ${end}) - <strong>Lokasi:</strong> ${day.location}</li>`;
        }).join("");

        const speakers = event.event_days
          .map(d => d.speaker)
          .filter((v, i, arr) => v && arr.indexOf(v) === i);

        const pembicaraStr = speakers.length
          ? `<ul>${speakers.map(p => `<li>${p}</li>`).join("")}</ul>`
          : "Tidak ada pembicara.";

        document.getElementById("event-detail").innerHTML = `
          <div class="col-md-5 mb-4 mb-md-0">
            <img src="/uploads/${event.poster_uri}" alt="${event.title}" class="img-fluid rounded shadow">
          </div>
          <div class="col-md-7">
            <h2 class="mb-3">${event.title}</h2>
            <p class="mb-4" style="color: #333;">${event.deskripsi}</p>
            <h5>Waktu & Lokasi:</h5>
            <ul>${eventDaysStr}</ul>
            <h5>Pembicara:</h5>
            ${pembicaraStr}
            <h5>Kuota Maksimum:</h5>
            <p>${event.max_participants} orang</p>
            <button class="btn btn-danger mt-3" data-bs-toggle="modal" data-bs-target="#daftarModal">Daftar Sekarang</button>
          </div>
        `;

        document.getElementById("daftarForm").addEventListener("submit", (e) => {
          e.preventDefault();
          const nama = document.getElementById("nama").value;
          const email = document.getElementById("email").value;

          console.log({ nama, email });

          alert("Form berhasil dikirim!\n(Nama: " + nama + ", Email: " + email + ")");
          const modal = bootstrap.Modal.getInstance(document.getElementById('daftarModal'));
          modal.hide();
          e.target.reset();
        });

      } catch (error) {
        console.error("Gagal mengambil detail event:", error);
        document.getElementById("event-detail").innerHTML = "<p>Gagal memuat detail event.</p>";
      }
    });
  </script>

</body>
</html>
